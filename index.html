<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>In Real Life ID - Proof of Personhood</title>
  <link rel="stylesheet" href="css/style.css">
</head>
<body>
  <header>
    <img src="logo.png" alt="In Real Life ID Logo" id="logo">
    <nav>
      <ul class="navbar">
        <li><a href="index.html">Home</a></li>
        <li><a href="about.html">About</a></li>
        <li><a href="features.html">Features</a></li>
        <li><a href="application.html">Application</a></li>
        <li><a href="receipt.html">Receipt</a></li>
        <li><a href="contact.html">Contact</a></li>
      </ul>
    </nav>
  </header>

  <main>
    <h2>My IRLid QR</h2>
    <p>Scan this with the other person’s phone to open the Application and begin scanning.</p>

    <div class="qr-box" id="myQr"></div>

    <button class="btn" onclick="location.href='application.html'">Go to Application (Scan)</button>
  </main>

  <footer>
    IRLid — Proof of Personhood (Demo)
  </footer>

  <script src="js/sign.js"></script>
  <script src="js/qr.js"></script>
  <script>
    (async () => {
      const pub = await getPublicJwk();
      const hello = {
        v: 1,
        type: "hello",
        pub,
        nonce: crypto.getRandomValues(new Uint32Array(1))[0],
        ts: Math.floor(Date.now()/1000)
      };

      const encodedHello = b64urlEncode(new TextEncoder().encode(JSON.stringify(hello)));

      // ✅ Force LAN IP so Android camera opens the correct computer
      const LAN_IP = "192.168.1.151";
      const PORT = location.port || "8000";
      const baseUrl = `http://${LAN_IP}:${PORT}`;

      const url = `${baseUrl}/application.html#HELLO=${encodedHello}`;
      makeQR("myQr", url, 320);
    })();
  </script>
</body>
</html>
